<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Billboard Animation Console Test</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #000;
            color: #00ffcc;
            font-family: monospace;
        }
        #console {
            background: #111;
            border: 1px solid #00ffcc;
            padding: 10px;
            height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        #gameContainer {
            width: 800px;
            height: 400px;
            border: 1px solid #00ffcc;
            margin: 20px 0;
        }
        button {
            background: #00ffcc;
            color: #000;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>Billboard Animation Console Test</h1>
    <div id="gameContainer"></div>
    <button onclick="clearConsole()">Clear Console</button>
    <button onclick="testAnimations()">Test Animations</button>
    
    <div id="console"></div>

    <script type="module">
        import { GameEngine } from './src/core/GameEngine.js';
        
        const consoleDiv = document.getElementById('console');
        const gameContainer = document.getElementById('gameContainer');
        
        // Override console.log to show in our div
        const originalLog = console.log;
        console.log = function(...args) {
            originalLog(...args);
            const message = args.map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
            ).join(' ');
            consoleDiv.textContent += new Date().toLocaleTimeString() + ': ' + message + '\n';
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        };
        
        // Override console.error too
        const originalError = console.error;
        console.error = function(...args) {
            originalError(...args);
            const message = args.map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
            ).join(' ');
            consoleDiv.textContent += '[ERROR] ' + new Date().toLocaleTimeString() + ': ' + message + '\n';
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        };
        
        window.clearConsole = function() {
            consoleDiv.textContent = '';
        };
        
        window.testAnimations = function() {
            console.log('Testing billboard animations manually...');
            if (window.gameEngine && window.gameEngine.systems.has('EnvironmentSystem')) {
                const envSystem = window.gameEngine.systems.get('EnvironmentSystem');
                console.log('EnvironmentSystem found, billboard animations:', envSystem.billboardAnimations.length);
                if (envSystem.billboardAnimations.length > 0) {
                    console.log('Calling updateBillboardAnimations manually...');
                    envSystem.updateBillboardAnimations();
                    console.log('Manual animation update complete');
                }
            } else {
                console.log('EnvironmentSystem not found or not initialized');
            }
        };
        
        let gameEngine;
        
        async function initGame() {
            try {
                console.log('üéÆ Initializing game engine...');
                gameEngine = new GameEngine();
                
                // Append the renderer's canvas to our container instead of body
                await gameEngine.init();
                
                // Move the canvas to our container
                const canvas = document.querySelector('canvas');
                if (canvas) {
                    canvas.remove();
                    gameContainer.appendChild(canvas);
                    canvas.style.width = '100%';
                    canvas.style.height = '100%';
                }
                
                window.gameEngine = gameEngine;
                console.log('‚úÖ Game engine initialized');
                console.log('Systems loaded:', Array.from(gameEngine.systems.keys()));
                
                // Check billboard animations after a short delay
                setTimeout(() => {
                    const envSystem = gameEngine.systems.get('EnvironmentSystem');
                    if (envSystem) {
                        console.log('Billboard animations count:', envSystem.billboardAnimations.length);
                        console.log('Billboard objects count:', envSystem.billboards.length);
                    }
                }, 2000);
                
            } catch (error) {
                console.error('‚ùå Failed to initialize game:', error);
            }
        }
        
        initGame();
    </script>
</body>
</html>
