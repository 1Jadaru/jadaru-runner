<!DOCTYPE html>
<html>
<head>
    <title>Billboard Color Debug Test</title>
    <style>
        body { margin: 0; background: #000; overflow: hidden; font-family: Arial, sans-serif; }
        canvas { display: block; }
        #info {
            position: absolute;
            top: 10px;
            left: 10px;
            color: white;
            background: rgba(0,0,0,0.7);
            padding: 10px;
            border-radius: 5px;
            z-index: 100;
        }
    </style>
</head>
<body>
    <div id="info">
        <h3>Billboard Color Debug Test</h3>
        <p>Testing billboard without neon trim to identify color overlay issue</p>
        <p>Use WASD or arrow keys to move camera around</p>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        // Scene setup
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer();
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setClearColor(0x000011);
        document.body.appendChild(renderer.domElement);

        // Camera controls
        const keys = { w: false, a: false, s: false, d: false };
        
        document.addEventListener('keydown', (e) => {
            keys[e.key.toLowerCase()] = true;
        });
        
        document.addEventListener('keyup', (e) => {
            keys[e.key.toLowerCase()] = false;
        });

        // Create animated canvas texture
        function createAnimatedTexture() {
            const canvas = document.createElement('canvas');
            canvas.width = 512;
            canvas.height = 256;
            const context = canvas.getContext('2d');
            
            // Clear and set up test pattern
            context.fillStyle = '#ff0000';  // Bright red background
            context.fillRect(0, 0, canvas.width, canvas.height);
            
            context.fillStyle = '#ffffff';  // White text
            context.font = 'bold 48px Arial';
            context.textAlign = 'center';
            context.textBaseline = 'middle';
            context.fillText('COLOR TEST', canvas.width / 2, canvas.height / 2);
            
            const texture = new THREE.CanvasTexture(canvas);
            texture.generateMipmaps = false;
            texture.wrapS = THREE.ClampToEdgeWrapping;
            texture.wrapT = THREE.ClampToEdgeWrapping;
            texture.minFilter = THREE.LinearFilter;
            texture.magFilter = THREE.LinearFilter;
            texture.needsUpdate = true;
            
            return { texture, canvas, context };
        }

        // Create billboard without neon trim
        function createCleanBillboard() {
            const group = new THREE.Group();
            
            // Support post
            const postGeometry = new THREE.CylinderGeometry(0.1, 0.15, 3.5);
            const postMaterial = new THREE.MeshBasicMaterial({ color: 0x333333 });
            const post = new THREE.Mesh(postGeometry, postMaterial);
            post.position.set(0, 1.75, -0.3);
            group.add(post);
            
            // Frame (no emissive properties)
            const frameGeometry = new THREE.BoxGeometry(3.4, 2.4, 0.1);
            const frameMaterial = new THREE.MeshBasicMaterial({ color: 0x555555 });
            const frame = new THREE.Mesh(frameGeometry, frameMaterial);
            frame.position.set(0, 2, -0.05);
            group.add(frame);
            
            // Screen with texture
            const screenGeometry = new THREE.PlaneGeometry(3.2, 2.2);
            const { texture, canvas, context } = createAnimatedTexture();
            const screenMaterial = new THREE.MeshBasicMaterial({
                map: texture,
                side: THREE.DoubleSide,
                transparent: false
            });
            
            const screen = new THREE.Mesh(screenGeometry, screenMaterial);
            screen.position.set(0, 2, 0);
            group.add(screen);
            
            // NO NEON TRIM - this is the test
            
            return { group, texture, canvas, context };
        }

        // Create billboard with problematic neon trim
        function createProblematicBillboard() {
            const group = new THREE.Group();
            
            // Support post
            const postGeometry = new THREE.CylinderGeometry(0.1, 0.15, 3.5);
            const postMaterial = new THREE.MeshBasicMaterial({ color: 0x333333 });
            const post = new THREE.Mesh(postGeometry, postMaterial);
            post.position.set(0, 1.75, -0.3);
            group.add(post);
            
            // Frame
            const frameGeometry = new THREE.BoxGeometry(3.4, 2.4, 0.1);
            const frameMaterial = new THREE.MeshBasicMaterial({ color: 0x555555 });
            const frame = new THREE.Mesh(frameGeometry, frameMaterial);
            frame.position.set(0, 2, -0.05);
            group.add(frame);
            
            // Screen with texture
            const screenGeometry = new THREE.PlaneGeometry(3.2, 2.2);
            const { texture, canvas, context } = createAnimatedTexture();
            const screenMaterial = new THREE.MeshBasicMaterial({
                map: texture,
                side: THREE.DoubleSide,
                transparent: false
            });
            
            const screen = new THREE.Mesh(screenGeometry, screenMaterial);
            screen.position.set(0, 2, 0);
            group.add(screen);
            
            // PROBLEMATIC NEON TRIM - likely causing the color overlay
            const neonGeometry = new THREE.BoxGeometry(3.2, 2.2, 0.05);
            const neonMaterial = new THREE.MeshBasicMaterial({
                color: 0x00ffcc,  // Cyan/greenish color
                transparent: true,
                opacity: 0.3  // Reduced opacity to see the effect
            });
            const neon = new THREE.Mesh(neonGeometry, neonMaterial);
            neon.position.set(0, 2, 0.05);  // Very close to screen
            group.add(neon);
            
            return { group, texture, canvas, context };
        }

        // Create both billboards for comparison
        const cleanBillboard = createCleanBillboard();
        cleanBillboard.group.position.set(-4, 0, -5);
        scene.add(cleanBillboard.group);

        const problematicBillboard = createProblematicBillboard();
        problematicBillboard.group.position.set(4, 0, -5);
        scene.add(problematicBillboard.group);

        // Add labels
        function addLabel(text, position) {
            const canvas = document.createElement('canvas');
            canvas.width = 256;
            canvas.height = 64;
            const context = canvas.getContext('2d');
            
            context.fillStyle = '#000000';
            context.fillRect(0, 0, canvas.width, canvas.height);
            context.fillStyle = '#ffffff';
            context.font = 'bold 24px Arial';
            context.textAlign = 'center';
            context.textBaseline = 'middle';
            context.fillText(text, canvas.width / 2, canvas.height / 2);
            
            const texture = new THREE.CanvasTexture(canvas);
            const geometry = new THREE.PlaneGeometry(2, 0.5);
            const material = new THREE.MeshBasicMaterial({ map: texture, transparent: true });
            const mesh = new THREE.Mesh(geometry, material);
            mesh.position.copy(position);
            mesh.position.y -= 1.5;
            scene.add(mesh);
        }

        addLabel('CLEAN (No Neon)', new THREE.Vector3(-4, 0, -5));
        addLabel('PROBLEMATIC (With Neon)', new THREE.Vector3(4, 0, -5));

        // Position camera
        camera.position.set(0, 2, 0);
        camera.lookAt(0, 2, -5);

        // Animation loop
        function animate() {
            requestAnimationFrame(animate);
            
            // Camera movement
            const speed = 0.1;
            if (keys.w) camera.position.z -= speed;
            if (keys.s) camera.position.z += speed;
            if (keys.a) camera.position.x -= speed;
            if (keys.d) camera.position.x += speed;
            
            // Update textures
            const time = Date.now() * 0.001;
            
            // Update clean billboard
            const cleanCtx = cleanBillboard.context;
            cleanCtx.fillStyle = '#ff0000';
            cleanCtx.fillRect(0, 0, 512, 256);
            cleanCtx.fillStyle = '#ffffff';
            cleanCtx.font = 'bold 48px Arial';
            cleanCtx.textAlign = 'center';
            cleanCtx.textBaseline = 'middle';
            cleanCtx.fillText('CLEAN TEST', 256, 128);
            cleanBillboard.texture.needsUpdate = true;
            
            // Update problematic billboard
            const probCtx = problematicBillboard.context;
            probCtx.fillStyle = '#ff0000';
            probCtx.fillRect(0, 0, 512, 256);
            probCtx.fillStyle = '#ffffff';
            probCtx.font = 'bold 48px Arial';
            probCtx.textAlign = 'center';
            probCtx.textBaseline = 'middle';
            probCtx.fillText('PROBLEMATIC', 256, 128);
            problematicBillboard.texture.needsUpdate = true;
            
            renderer.render(scene, camera);
        }

        animate();

        // Handle window resize
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
